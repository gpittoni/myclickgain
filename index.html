<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyClickGain</title>
    <script type="module">
        // Importar las funciones necesarias del SDK de Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getDatabase, ref, set, push, get, child, orderByChild, query, limitToLast } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDyYBWmFdAOycu2_XXUpAKf6poueGP6u_w",
            authDomain: "myclickgain.firebaseapp.com",
            databaseURL: "https://myclickgain-default-rtdb.firebaseio.com",
            projectId: "myclickgain",
            storageBucket: "myclickgain.appspot.com",
            messagingSenderId: "363868466611",
            appId: "1:363868466611:web:92582a22a383e75b8befc6"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        let puntos = 0;
        let currentUser = null;

        // Función para sumar un punto
        function sumarPunto() {
            puntos += 1;
            actualizarPuntos();
        }

        // Función para aplicar el multiplicador del 50%
        function multiplicador50() {
            alert("Aquí iría el anuncio.");
            puntos = Math.round(puntos * 1.5);
            actualizarPuntos();
        }

        // Función para actualizar los puntos en la pantalla
        function actualizarPuntos() {
            document.getElementById("puntos").textContent = puntos;
        }

        // Función para guardar el puntaje en Firebase
        function guardarPuntaje() {
            if (currentUser) {
                const puntajeRef = push(ref(db, 'ranking'));
                set(puntajeRef, {
                    nombre: currentUser.displayName,
                    puntos: puntos
                });
            }
        }

        // Función para cargar el ranking desde Firebase
        function cargarRanking() {
            const rankingRef = ref(db, 'ranking');
            const rankingQuery = query(rankingRef, orderByChild('puntos'), limitToLast(10));
            get(rankingQuery).then((snapshot) => {
                let rankingHTML = "";
                let rankingArray = [];

                snapshot.forEach(childSnapshot => {
                    rankingArray.push(childSnapshot.val());
                });

                rankingArray.reverse().forEach((jugador, index) => {
                    rankingHTML += `<p>${index + 1}. ${jugador.nombre}: ${jugador.puntos} puntos</p>`;
                });

                document.getElementById("ranking").innerHTML = rankingHTML;
            }).catch(error => {
                console.error("Error al cargar el ranking:", error);
            });
        }

        // Función de login con Google
        function login() {
            const provider = new GoogleAuthProvider();
            signInWithPopup(auth, provider)
                .then(result => {
                    currentUser = result.user;
                    document.getElementById("user-info").innerHTML = `Hola, ${currentUser.displayName}`;
                    document.getElementById("login-btn").style.display = "none";
                    document.getElementById("logout-btn").style.display = "block";
                    cargarRanking();
                })
                .catch(error => {
                    console.error("Error de autenticación:", error);
                });
        }

        // Función de logout
        function logout() {
            signOut(auth).then(() => {
                currentUser = null;
                document.getElementById("user-info").innerHTML = "";
                document.getElementById("login-btn").style.display = "block";
                document.getElementById("logout-btn").style.display = "none";
                cargarRanking();
            }).catch(error => {
                console.error("Error al cerrar sesión:", error);
            });
        }

        // Escuchar cambios en el estado de autenticación
        onAuthStateChanged(auth, user => {
            if (user) {
                currentUser = user;
                document.getElementById("user-info").innerHTML = `Hola, ${user.displayName}`;
                document.getElementById("login-btn").style.display = "none";
                document.getElementById("logout-btn").style.display = "block";
                cargarRanking();
            } else {
                document.getElementById("user-info").innerHTML = "";
                document.getElementById("login-btn").style.display = "block";
                document.getElementById("logout-btn").style.display = "none";
            }
        });
    </script>
</head>
<body>
    <h1>MyClickGain</h1>
    <p>Puntos: <span id="puntos">0</span></p>
    <button class="btn-click" onclick="sumarPunto()">¡Clickea aquí!</button>
    <button class="btn-multiplicar" onclick="multiplicador50()">Multiplicador 50%<br><span>(Ver anuncio)</span></button>

    <h2>🏆 Ranking - Top 10</h2>
    <div id="ranking" class="ranking"></div>

    <div id="user-info" class="user-info"></div>
    
    <button id="login-btn" onclick="login()">Iniciar sesión con Google</button>
    <button id="logout-btn" style="display:none;" onclick="logout()">Cerrar sesión</button>
</body>
</html>
